<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f4f4f4;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

<form id="registerForm">
    <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" required>
    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
    <input type="email" name="email" placeholder="Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
    <input type="text" name="name" placeholder="–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
    <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
</form>

<div id="result">
    –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
</div>

<div style="margin-top: 20px;">
    <button onclick="testAllEndpoints()">–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</button>
</div>
<hr style="margin: 40px 0;">

<!-- üëá –ù–û–í–´–ô –ë–õ–û–ö –î–õ–Ø –¢–ï–°–¢–ê –í–•–û–î–ê -->
<h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞ (POST /api/auth/login)</h3>
<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∞ -->
    <div style="margin-bottom: 15px;">
        <strong>–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç:</strong>
        <button onclick="fillTestData('test@example.com', 'password123')" style="margin: 0 5px; padding: 5px 10px; background: #6c757d; color: white; border: none; border-radius: 3px;">
            –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        </button>
        <button onclick="fillTestData('new@test.com', '123456')" style="margin: 0 5px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px;">
            –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        </button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—Ö–æ–¥–∞ -->
    <form id="loginTestForm">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="email" id="loginEmail" name="email" placeholder="Email"
                   style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            <input type="password" id="loginPassword" name="password" placeholder="–ü–∞—Ä–æ–ª—å"
                   style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
        <button type="submit"
                style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            üîê –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –≤—Ö–æ–¥–∞
        </button>
        <button type="button" onclick="clearLoginResult()"
                style="margin-left: 10px; padding: 10px 15px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
            –û—á–∏—Å—Ç–∏—Ç—å
        </button>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ -->
    <div id="loginTestResult"
         style="margin-top: 20px; padding: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 14px;">
        <div style="color: #6c757d;">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ö–æ–¥–∞...</div>
        <div id="loginTestDetails"></div>
    </div>
</div>

<script>
    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    function fillTestData(email, password) {
        document.getElementById('loginEmail').value = email;
        document.getElementById('loginPassword').value = password;
        document.getElementById('loginTestResult').innerHTML =
            '<div style="color: #17a2b8;">‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + email + '</div>';
    }

    // –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    function clearLoginResult() {
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('loginTestResult').innerHTML =
            '<div style="color: #6c757d;">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ö–æ–¥–∞...</div>';
        document.getElementById('loginTestDetails').innerHTML = '';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
    document.getElementById('loginTestForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        const resultDiv = document.getElementById('loginTestResult');
        const detailsDiv = document.getElementById('loginTestDetails');

        resultDiv.innerHTML = '<div style="color: #17a2b8;">‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å POST /api/auth/login...</div>';
        detailsDiv.innerHTML = '';

        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            });

            const result = await response.json();

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
            let statusColor, statusText;
            if (response.ok && result.token && !result.token.includes('Invalid')) {
                statusColor = '#28a745'; // –ó–µ–ª–µ–Ω—ã–π
                statusText = '‚úÖ –£–°–ü–ï–•';
            } else {
                statusColor = '#dc3545'; // –ö—Ä–∞—Å–Ω—ã–π
                statusText = '‚ùå –û–®–ò–ë–ö–ê';
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            resultDiv.innerHTML = `
                <div style="color: ${statusColor}; font-weight: bold; margin-bottom: 10px;">
                    ${statusText} | –°—Ç–∞—Ç—É—Å: ${response.status} ${response.ok ? 'OK' : ''}
                </div>
            `;

            // –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            let details = '<div style="margin-top: 15px;"><strong>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</strong><br>';

            if (result.token) {
                if (result.token.includes('Invalid')) {
                    details += `<span style="color: #dc3545;">–¢–æ–∫–µ–Ω: ${result.token}</span><br>`;
                } else {
                    const shortToken = result.token.length > 50 ?
                        result.token.substring(0, 50) + '...' : result.token;
                    details += `<span style="color: #28a745;">–¢–æ–∫–µ–Ω (–ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤): ${shortToken}</span><br>`;
                    details += `<small style="color: #6c757d;">(–ü–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω —Å–º–æ—Ç—Ä–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ F12 ‚Üí Console)</small><br>`;
                }
            }

            if (result.userId) {
                details += `ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${result.userId}<br>`;
            }

            if (result.email) {
                details += `Email: ${result.email}<br>`;
            }

            if (result.message) {
                details += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}<br>`;
            }

            details += '</div>';
            detailsDiv.innerHTML = details;

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            console.log('–¢–µ—Å—Ç –≤—Ö–æ–¥–∞:', { email, response: result });

        } catch (error) {
            resultDiv.innerHTML = `
                <div style="color: #dc3545; font-weight: bold;">‚ùå –û–®–ò–ë–ö–ê –°–ï–¢–ò</div>
                <div style="margin-top: 10px; color: #6c757d;">${error.message}</div>
            `;
            console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –≤—Ö–æ–¥–∞:', error);
        }
    });
</script>
<script>
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    document.getElementById('registerForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã

        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
        const formData = new FormData(this);
        const data = {
            username: formData.get('username'),
            password: formData.get('password'),
            email: formData.get('email') || '',
            name: formData.get('name') || ''
        };

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
        document.getElementById('result').innerHTML =
            '<p style="color: blue;">–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...</p>' +
            '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å
            const response = await fetch('/api/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
            const result = await response.json();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const statusColor = response.ok ? 'green' : 'red';
            document.getElementById('result').innerHTML =
                `<p style="color: ${statusColor}; font-weight: bold;">
                    –°—Ç–∞—Ç—É—Å: ${response.status} ${response.ok ? 'OK ‚úì' : '–û—à–∏–±–∫–∞ ‚úó'}
                </p>
                <p>–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}</p>
                <p>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${result.userId || '‚Äî'}</p>
                <p>URL –∑–∞–ø—Ä–æ—Å–∞: POST /api/auth/register</p>`;

        } catch (error) {
            document.getElementById('result').innerHTML =
                `<p style="color: red;">–û—à–∏–±–∫–∞: ${error.message}</p>`;
        }
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
    async function testAllEndpoints() {
        const endpoints = [
            { method: 'GET', url: '/' },
            { method: 'GET', url: '/test' },
            { method: 'GET', url: '/db-check' },
            { method: 'GET', url: '/api/auth/test' }
        ];

        let results = '<h3>–¢–µ—Å—Ç –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:</h3>';

        for (const endpoint of endpoints) {
            try {
                const response = await fetch(endpoint.url, {
                    method: endpoint.method
                });
                const text = await response.text();
                results += `
                    <div style="margin: 10px 0; padding: 10px; background: #f0f0f0;">
                        <strong>${endpoint.method} ${endpoint.url}</strong><br>
                        –°—Ç–∞—Ç—É—Å: ${response.status}<br>
                        –û—Ç–≤–µ—Ç: ${text}
                    </div>`;
            } catch (error) {
                results += `
                    <div style="margin: 10px 0; padding: 10px; background: #ffdddd;">
                        <strong>${endpoint.method} ${endpoint.url}</strong><br>
                        –û—à–∏–±–∫–∞: ${error.message}
                    </div>`;
            }
        }

        document.getElementById('result').innerHTML = results;
    }
</script>
</body>
</html>